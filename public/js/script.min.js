jQuery,window.MKDAIQ_convertDate=function(a){var t=a.split(" "),n=t[0].substring(0,4),e=t[0].substring(4,6),i=t[0].substring(6,8),o=t[1]+":00";return new Date(n+"-"+e+"-"+i+" "+o)},window.MKDAIQ_StationData=function(a,t){var n=[],e=0;for(var i in t)t.hasOwnProperty(i)&&n.splice(e++,0,{value:t[i][a],date:i});return n},window.MKDAIQ_LastResult=function(a){for(var t=null,n=a.length-1;n>=0;n--){var e=a[n].value;if(""!==e&&!isNaN(e)){t=e;break}}return t},window.MKDAIQ_Quality_Range=function(a,t){var n=t.index,e=null,i=null;for(var o in a=parseFloat(a),n)if(n.hasOwnProperty(o)&&(e=parseFloat(n[o].from),i=parseFloat(n[o].to),a>=e&&a<=i))return n[o];return null},window.MKDAIQ_Popup=function(a,t,n,e,i){var o,r='<div class="mkdaiq-map-pupup">';if(t.length>0){var s=a+" ("+e+")";for(var d in r+='<div class="mkdaiq-map-head"><h3>'+s+"</h3><h4>"+i+"</h4></div>",r+='<div class="mkdaiq-map-body">',r+='<table class="mkdaiq-map-data">',t=t.reverse()){var l=window.MKDAIQ_convertDate(t[d].date);""===(o=t[d].value)?o=MKDAIQ.strings.not_measured:o+=" "+MKDAIQ.strings.micrograms,r+='<tr class="mkdaiq-map-data-entry" style="'+(d>5?"display:none;":"")+'">',r+='<td class="mkdaiq-map-data-time">',r+=l.toLocaleTimeString(),r+="</td>",r+='<td class="mkdaiq-map-data-value">',r+=o,r+="</td>",r+="</tr>"}r+="</table>",r+='<p class="mkdaiq-map-expand-results"><a href="#">Show full results</a>',r+="</div>"}else r+="<p>"+MKDAIQ.strings.measurements_not_found+"</p>";return r+="</div>"},function(a){a.fn.mkdaiqLC=function(){if("undefined"!=typeof Chart){var t=this,n=t.find(".mkdaiq-chart"),e=t.find(".mkdaiq-select-station"),i=t.data("default-station"),o=t.data("default-unit"),r=t.data("default-timemode"),s=t.data("date"),d=parseInt(t.data("date-labels")),l=(t.data("stations-selector"),null);t.initializeChart=function(t,e,i,o){var r=n.get(0);a.ajax({url:MKDAIQ.ajax_url+"?action=mkdaiq_query&nonce="+MKDAIQ.nonce,cache:!1,type:"GET",data:{station:t,timemode:e,unit:i,end_date:o},beforeStart:function(){n.html("Loading...")},success:function(a){var n=MKDAIQ.config.colors;if(a.success){var e,o,s,u=a.data.measurements,c=[],m=t.split(","),p=0;for(var f in m)if(m.hasOwnProperty(f)){for(var h in e=[],o=[],s=m[f],u)if(u.hasOwnProperty(h)){var v=u[h][s],k=window.MKDAIQ_convertDate(h);o.push(k.toLocaleString()),e.push({t:k,y:parseFloat(v)})}c.push({label:s,data:e,fill:!1,borderColor:n[p],lineTension:.1}),p++}var w={responsive:!0,hoverMode:"index",stacked:!1,scales:{xAxes:[{afterTickToLabelConversion:function(a){var t=a.ticks;t.forEach(function(a,n){n%2==1&&(t[n]="")})},ticks:{maxRotation:90,minRotation:90,display:d}}]},tooltips:{callbacks:{label:a=>`${a.yLabel} ${MKDAIQ.strings.micrograms} (${i})`}},legend:{display:!0}},g={labels:o,datasets:c};l?(l.data=g,l.options=w,l.update()):l=new Chart(r,{type:"line",data:g,options:w})}else console.error(a.data)},error:function(a){console.error("MKDAIQ: Unable to initialize.")}})},t.initializeChart(i,r,o,s),e.length>0&&e.on("change",function(n){var e=a(this).val();t.initializeChart(e,r,o,s)})}},a(".mkdaiq-linechart-element").each(function(){a(this).mkdaiqLC()})}(jQuery),function(a){a(document).on("click",".mkdaiq-map-expand-results",function(t){t.preventDefault(),a(this).closest(".mkdaiq-map-pupup").find(".mkdaiq-map-data-entry").show(),a(this).hide()}),a.fn.mkdaiqMAP=function(){if("undefined"!=typeof L){var t=this,n=t.find(".mkdaiq-map"),e=(t.find(".mkdaiq-select-date"),t.find(".mkdaiq-select-unit")),i=t.data("unit"),o=t.data("date"),r=t.data("zoom"),s=null;t.initializeMap=function(t,e,i,o){var d=[41.5559,21.7365];r||(r=8);var l=n.attr("id");a.ajax({url:MKDAIQ.ajax_url+"?action=mkdaiq_query_map_data&nonce="+MKDAIQ.nonce,cache:!1,type:"GET",data:{station:t,timemode:e,unit:i,end_date:o},beforeStart:function(){n.html("Loading...")},success:function(a){if(null!==s&&(d=s.getCenter(),r=s.getZoom(),s.off(),s.remove()),a.success){s=L.map(l).setView(d,r),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:""}).addTo(s);var t,n,e,u,c,m,p,f,h=a.data.units[i];for(var v in a.data.stations)a.data.stations.hasOwnProperty(v)&&(t=a.data.stations[v].lat,n=a.data.stations[v].lng,e=a.data.stations[v].name,u=window.MKDAIQ_StationData(v,a.data.measurements),c=window.MKDAIQ_LastResult(u),p=null!==(m=window.MKDAIQ_Quality_Range(c,h))&&m.hasOwnProperty("slug")?m.slug:"undefined",f=L.divIcon({className:"mkdaiq-pin mkdaiq-color-"+p,iconSize:new L.Point(30,30)}),L.marker([t,n],{icon:f}).addTo(s).bindPopup(window.MKDAIQ_Popup(e,u,c,i,o),{maxWidth:300}))}else console.error(a.data)},error:function(a){console.error("MKDAIQ: Unable to initialize.")}})},t.initializeMap(null,null,i,o),e.length>0&&e.on("change",function(n){var e=a(this).val();t.initializeMap(null,null,e,o)})}},a(".mkdaiq-map-element").each(function(){a(this).mkdaiqMAP()})}(jQuery);